# Review History: 021-project-level-workflow

## Stage 1: Spec-Reviewer Review - Iteration 1 - 2026-02-10T12:15:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [clarity] Scale signals referenced but not enumerated in spec (at: FR-1, Success Criteria line 1)
- [blocker] [clarity] Decomposition output schema referenced but not defined (at: FR-3, AC-4)
- [blocker] [clarity] Project .meta.json schema not defined (at: FR-2, AC-3)
- [blocker] [assumptions] Feature creation mechanism from decomposition ambiguous (at: FR-4, AC-7)
- [blocker] [assumptions] Planned→active transition entirely unspecified (at: Scope, AC section)
- [warning] [traceability] Phase 1 single-active constraint not acknowledged (at: Out of Scope)
- [warning] [traceability] depends_on_features enforcement deferral not stated (at: FR-4)
- [warning] [traceability] AC-15 vs Out of Scope contradiction on show-status (at: AC-15, Out of Scope line 3)
- [warning] [testability] Milestone grouping range vague (at: AC-6)
- [warning] [assumptions] validate.sh planned feature compatibility (at: Success Criteria line 10)
- [warning] [assumptions] Context injection mechanism unclear (at: FR-4b)
- [warning] [assumptions] expected_lifetime setter unspecified (at: FR-5, AC-3)
- [warning] [testability] AC-12/13 test LLM judgment (at: AC-12, AC-13)
- [suggestion] [clarity] Component count "11" unclear (at: FR-6, Success Criteria line 15)
- [suggestion] [clarity] AC-8/9 "available as context" not verifiable (at: AC-8, AC-9)
- [suggestion] [clarity] /create-project command interface unspecified (at: FR-2)

**Changes Made:**
- Enumerated all 6 scale signals with detection heuristics in FR-1
- Added full decomposition output JSON schema in FR-3
- Added full project .meta.json schema in FR-2 with expected_lifetime
- Specified decomposing skill creates feature directories directly (FR-4)
- Added complete planned→active transition flow (5 steps) with AC-8
- Added single-active-feature enforcement for Phase 1 in FR-4
- Added explicit deferral note for depends_on_features enforcement
- Clarified Out of Scope: "Full project dashboard" vs basic grouping in Phase 1
- Delegated milestone grouping to LLM decomposer via suggested_milestones
- Added validate.sh planned feature compatibility with AC-18
- Specified context injection as Step 5 in validateAndSetup with exact markdown format
- Specified expected_lifetime set during project creation via AskUserQuestion
- Reframed AC-12/13 to test system-level behavior (prompt criteria, JSON fields)
- Clarified component count as "6 direct + 5 phase commands via workflow-transitions"
- Reframed AC-8/9 as verifiable assertions (presence of headings in input context)
- Specified /create-project as both auto-invoked and standalone with --prd argument

---

## Stage 1: Spec-Reviewer Review - Iteration 2 - 2026-02-10T12:30:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved (all 5 blockers resolved)

---

## Stage 2: Phase Review - 2026-02-10T12:35:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [warning] FR-5/FR-6 numbering collides with PRD Phase 2 FR numbers — noted for traceability
- [warning] expected_lifetime is a spec-level addition to PRD schema — noted for traceability
- [warning] No AC for list-features with planned features — designer can infer from FR-6
- [suggestion] Decomposition output feature names → id-slug mapping not explicitly called out
- [suggestion] Project .meta.json schema example shows post-decomposition state vs AC-3 creation state

---

## Stage 1: Spec-Reviewer Review - Iteration 3 - 2026-02-10T13:00:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved

**Issues:**
- [warning] [assumptions] Planned→active transition triggers misleading 'skipping brainstorm' warning (at: FR-4)
- [warning] [assumptions] validate.sh already accepts nulls silently; need bidirectional validation (at: FR-6, AC-18)
- [warning] [clarity] BLOCKED state in Stage 7 AskUserQuestion not specified for project option (at: AC-1, FR-1)
- [warning] [clarity] Decomposition-created features bypass create-feature side effects (kanban, auto-specify) (at: FR-4)
- [warning] [assumptions] Session-start needs to read two .meta.json files when project_id present (at: FR-6)
- [warning] [assumptions] Project directory path resolution from project_id needs glob pattern (at: FR-4b, FR-4)
- [suggestion] [clarity] Project ID zero-padding width not explicit (at: FR-2)
- [suggestion] [clarity] Complexity field valid values not enumerated (at: FR-3 schema)

**Changes Made:**
- Added brainstorm skip suppression note for planned features with project_id (FR-4)
- Reframed validate.sh as bidirectional validation (non-null for active, null only for planned)
- Specified "Promote to Project" only in PASSED/SKIPPED state; BLOCKED unchanged (FR-1)
- Added create-feature side effects bypass note for planned features (FR-4)
- Added project directory resolution via glob pattern docs/projects/{project_id}-*/ (FR-4b)
- Updated session-start hook description with two-file read and graceful degradation (FR-6)
- Specified 3-digit zero-padding for project IDs (FR-2)
- Added complexity values: Low, Medium, High (FR-3 schema)

---

## Stage 2: Phase Review - Iteration 3 - 2026-02-10T13:00:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [warning] PRD specifies YAML front-matter for roadmap.md; spec drops it — divergence not acknowledged (at: FR-3)
- [warning] FR-5 expected_lifetime has no PRD provenance noted (at: FR-5)
- [warning] .meta.json schema example shows post-decomposition state (at: FR-2)
- [warning] AC-9 wording "PRD title heading" ambiguous vs FR-4b full content (at: AC-9)
- [suggestion] roadmap.md template example would help designer (at: FR-3, AC-6)
- [suggestion] Decomposing skill trigger (auto vs manual) not explicit (at: FR-3)

**Changes Made:**
- Added PRD divergence note for roadmap.md YAML front-matter (FR-3)
- Aligned AC-9 wording with FR-4b: full prd.md and roadmap.md content under headings
- Clarified decomposing skill is auto-invoked by create-project command (FR-3)
- roadmap.md template deferred to design phase (appropriate for design, not spec)

---

## Stage 1: Spec-Reviewer Review - Iteration 4 - 2026-02-10T13:30:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved

**Issues:**
- [warning] [assumptions] LLM topological sort reliability — design should evaluate programmatic alternative (at: Feasibility)
- [warning] [testability] AC-14 tests non-deterministic LLM behavior (at: AC-14)
- [warning] [clarity] Dual iteration cycle nesting ambiguity — 3 reviewer + 3 user = independent budgets (at: FR-3)
- [warning] [assumptions] Context injection may pressure context window for large projects (at: FR-4b, AC-9)
- [suggestion] [traceability] Roadmap YAML front-matter divergence should also appear in Out of Scope (at: FR-3)
- [suggestion] [clarity] validate.sh scope — cross-referential validation deferred (at: FR-4, AC-18)

**Changes Made:**
- Added design consideration note for programmatic topological sort (Feasibility)
- Added non-deterministic testing note to AC-14
- Clarified independent iteration budgets in decomposing skill description (FR-3)
- Added context size note with 30% threshold guidance (FR-4b)
- Added roadmap YAML front-matter to Out of Scope section
- Added validate.sh cross-referential validation deferral note (FR-4)

---

## Stage 2: Phase Review - Iteration 4 - 2026-02-10T13:30:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [warning] expected_lifetime PRD divergence not called out (at: FR-5/FR-2)
- [warning] AC-1 label text relationship to existing Stage 7 not stated (at: AC-1)
- [warning] create-project command flow implicit (at: FR-2, FR-3)
- [suggestion] Feasibility line numbers may drift (at: Feasibility)
- [suggestion] Reviewer output schema not shown (at: FR-3, AC-13)

**Changes Made:**
- Added PRD divergence note for expected_lifetime field (FR-5)
- Added label match note to AC-1 ("Promote to Project" is only new addition)
- Made create-project command flow explicit: prompt → create dir → write files → invoke decomposing (FR-2)
- Reviewer output schema deferred to design (appropriate level of detail)

---

## Stage 1: Spec-Reviewer Review - Iteration 5 - 2026-02-10T14:00:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved

**Issues:**
- [warning] [assumptions] expected_lifetime prompt unclear for brainstorm promotion path (at: FR-2)
- [warning] [clarity] AC-5 cycle detection → refinement iteration relationship ambiguous (at: AC-5)
- [warning] [testability] AC-14 non-deterministic — already addressed with verification note
- [suggestion] [traceability] FR-5/FR-6 numbering overlap with PRD — disclaimer adequate
- [suggestion] [traceability] Single-active-feature Phase 2 forward-reference (at: FR-4)

**Changes Made:**
- Clarified command flow applies to both invocation paths (FR-2)
- Linked AC-5 cycle detection to AC-12 refinement iterations explicitly
- Added Phase 2 forward-reference to single-active enforcement (FR-4)

---

## Stage 2: Phase Review - Iteration 5 - 2026-02-10T14:00:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [warning] "(recommended)" label implicit — only shown when threshold met
- [warning] ID assignment atomicity for concurrent runs — solo-dev safe
- [warning] AC-14 verification approach — already documented
- [suggestion] Topological sort LLM vs programmatic — clean handoff to design
- [suggestion] Context injection prompt placement — sufficient for design

**Changes Made:**
- No additional changes needed — warnings are design-level concerns already delegated

---

## Design Review - Iteration 1 - 2026-02-10T16:00:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [completeness] Brainstorm skip suppression mechanism undefined — validateTransition has no concept of project_id or planned status (at: C9 Step 7)
- [blocker] [completeness] show-status planned features duplicate across Section 1.5 and Section 2 (at: C10)
- [blocker] [completeness] User refinement feedback flow through decomposer unspecified — no previous_decomposition or refinement_feedback parameter (at: C2, I2, I3)
- [blocker] [completeness] tsort pipeline ordering inconsistency — Name→ID mapping placed after tsort but tsort example uses ID-slugs (at: C2 flow diagram vs tsort example)
- [warning] [consistency] validate.sh C13 pseudocode and I8 disagree on slug in required_always (at: C13 vs I8)
- [warning] [consistency] show-status "open" filter ambiguous for abandoned/completed project features (at: C10)
- [warning] [feasibility] Mode prompt bypass when "Promote to Project" selected not specified (at: C7)
- [warning] [completeness] Refine AskUserQuestion captures free-text how? AskUserQuestion is multiple-choice (at: C2)
- [warning] [completeness] Partial feature directory creation failure — rollback or leave partial? (at: C2, I2)
- [warning] [assumptions] tsort drops isolated nodes (no edges) — features with no deps and no dependents silently excluded (at: C2, TD-1)
- [warning] [completeness] Planned features have no prd.md — project PRD via context injection only? (at: C2, C8, C9)
- [warning] [consistency] User targets planned feature how? /specify without args only finds active (at: C9)
- [suggestion] [completeness] session-start available commands should include /create-project (at: C12)
- [suggestion] [consistency] Mermaid arrow semantics ("precedes" vs "depends on") should be labeled (at: C6)

**Changes Made:**
- [blocker] Brainstorm skip suppression: Specified concrete mechanism — planned→active sets `lastCompletedPhase` to `"brainstorm"`, making currentIndex=0 so /specify (index 1) is a normal forward transition. No code changes to validateTransition needed.
- [blocker] show-status duplication: Changed Section 1.5 to show ALL project features (all statuses); Section 2 now excludes planned AND project-linked features entirely.
- [blocker] User refinement feedback flow: Added full flow — AskUserQuestion "Other" captures free-text as `refinement_feedback`; decomposer receives original PRD + previous JSON + feedback text; fresh reviewer cycle per refinement.
- [blocker] tsort pipeline ordering: Reordered flow diagram — Name→ID-Slug mapping now happens BEFORE cycle detection and tsort; added rationale paragraph.
- [warning] validate.sh slug: Added clarifying comment to C13 pseudocode; aligned I8 interface.
- [warning] show-status "open" filter: Clarified Section 2 excludes project-linked features of any status.
- [warning] Mode prompt bypass: Added explicit "Mode prompt bypass" section to C7.
- [warning] Refine free-text: Specified AskUserQuestion's built-in "Other" option for free-text; added partial failure handling for feature directory creation.
- [warning] tsort isolated nodes: Added self-edges mechanism (`echo "F F"`) for every feature to guarantee all nodes appear in output.
- [warning] Planned features prd.md: Added explanation in C14 that planned features use project PRD via context injection only, no local prd.md.
- [warning] User targets planned feature: Added explanation in C9 that --feature argument required; show-status Section 1.5 makes planned features discoverable.
- [suggestion] session-start commands: Added /create-project to available commands in C12.
- [suggestion] Mermaid arrow semantics: Added arrow direction label and HTML comment to C6 template.

---

## Design Review - Iteration 2 - 2026-02-10T17:00:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved

**Issues:**
- [warning] [completeness] Project PRD context gap: specify reads local prd.md for reviewer prompts; project features have no local prd.md; Step 5 injects via prepend but reviewer prompts read file directly (at: C8, C14)
- [warning] [completeness] project-decomposer agent JSON schema underspecified — no concrete schema in C3, only summary description (at: C3)
- [warning] [completeness] project-decomposition-reviewer JSON schema underspecified — criteria_evaluated field referenced in AC-13 not shown in C4 (at: C4)
- [warning] [consistency] show-status Section 2 complete filter logic ambiguous for abandoned standalone features (at: C10)
- [warning] [assumptions] tsort "deterministic" claim imprecise — POSIX guarantees valid ordering, not unique; BSD vs GNU may differ (at: TD-1, C2)
- [warning] [completeness] Planned-to-active single-active check UX not fully specified (at: C9)
- [note] [completeness] Partial failure: project .meta.json features list state undefined after partial feature creation failure (at: C2)
- [note] [complexity] Cycle detection (DFS) and tsort both detect cycles — intentional redundancy for better error reporting (at: C2)

**Changes Made:**
- [warning] PRD in reviewer prompts: Added explicit mechanism in C14 — if no local prd.md AND project_id present, extract project PRD from Step 5's injected context; avoids duplicate file read.
- [warning] Decomposer JSON schema: Expanded C3 with complete schema, field-level documentation, and downstream consumer parsing instructions.
- [warning] Reviewer JSON schema: Expanded C4 with complete schema including criteria_evaluated field, field-level documentation, and example values.
- [warning] show-status Section 2 filter: Made complete filter logic explicit — `status NOT IN ('completed') AND project_id IS NULL OR ABSENT`; standalone abandoned features remain in Section 2 (matches current behavior).
- [warning] tsort determinism: Corrected TD-1 language from "deterministic" to "reproducible on the same platform"; added note about BSD vs GNU ordering differences being acceptable.
- [warning] Planned-to-active single-active: Expanded C9 transition with full AskUserQuestion flow including Cancel options at both confirmation and single-active check steps.
- [note] Partial failure project .meta.json: Clarified in C2 that features array is updated incrementally; milestones and roadmap written only after all features created.
- [note] DFS + tsort cycle detection redundancy: No change — intentional for better error reporting (noted as observation).

---

## Handoff Review - 2026-02-10T17:15:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [warning] C7 missing current Stage 7 AskUserQuestion structure for planner reference (at: C7)
- [warning] C10 Section 2 filter operator precedence ambiguous (at: C10)
- [warning] C2 decomposing skill token budget guidance missing for 500-line limit (at: C2)
- [warning] C14 PRD extraction described as string parsing rather than LLM instruction (at: C14)
- [suggestion] Component Interaction Matrix missing workflow-state active scan row (at: Matrix)
- [suggestion] C2 feature ID assignment scanning logic not explicit (at: C2)

**Changes Made:**
- Added current Stage 7 AskUserQuestion structure with line numbers to C7
- Fixed C10 filter with explicit parentheses for operator precedence
- Added token budget note to C2 with guidance on concise SKILL.md approach
- Reframed C14 PRD mechanism as LLM instruction rather than programmatic parsing
- Added workflow-state active scan row to Component Interaction Matrix
- Added feature ID assignment note to C2 Name→ID-Slug mapping step

---

## Stage 1: Plan Review - Iteration 1 - 2026-02-10T18:00:00Z

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] No concrete negative test cases for validate.sh changes — only positive verification (at: Phase 1, Step 1.2 Verification)
- [blocker] Dependency graph contradicts Phase 2 text — graph shows Phase 2 depends on Phase 1, text says "Dependencies: None" (at: Phase 2 Dependencies, Dependency Graph)
- [blocker] Unclear if validate.sh validates plugins/iflow-dev/ or plugins/iflow/ — release sync step missing (at: Testing Strategy, all Phase Checkpoints)
- [blocker] Phase commands need --feature argument for planned features but plan doesn't address this (at: Phase 5, Step 5.2)
- [warning] Decomposing skill 500-line budget lacks concrete sub-procedure extraction plan (at: Phase 3, Step 3.1 and Risk R1)
- [warning] validate.sh Python block inside bash quoting context not addressed (at: Phase 1, Step 1.2)
- [warning] session-start parse_feature_meta outputs 4 positional lines — adding project_id as 5th requires updating all sed consumers (at: Phase 7, Step 7.3)
- [warning] Brainstorming skill ~30 line estimate for scale detection may be optimistic (at: Phase 6, Step 6.1 and Risk R4)
- [warning] Phase 7 dependency graph shows dependency on Phase 6 that text doesn't list (at: Phase 7 Dependencies vs Dependency Graph)
- [warning] Feature ID collision if create-feature runs concurrently with decomposition (at: Phase 3, Step 3.1)
- [warning] Adding Step 5 to validateAndSetup changes 4-step to 5-step procedure (at: Phase 5, Step 5.1)

**Changes Made:**
- [blocker] Added test fixture verification with positive case (planned, null mode/branch → pass) and negative case (active, null mode/branch → fail) using agent_sandbox/ temp files
- [blocker] Fixed dependency graph: Phase 2 has NO dependency on Phase 1, can execute in parallel. Corrected graph and parallelization notes.
- [blocker] Added plugin validation note: validate.sh validates docs/features/ metadata and plugins/iflow-dev/ components. Added release sync step to DoD.
- [blocker] Confirmed --feature argument already exists on all phase commands (specify, design, create-plan, create-tasks, implement) via their YAML frontmatter argument-hint. No command modifications needed. Documented this in Step 5.2.
- [warning] Added concrete line count estimates for decomposing skill (~450 lines) and specific mitigation: extract roadmap template to reference file
- [warning] Added quoting note for validate.sh Python block inside bash context
- [warning] Expanded Step 7.3 with cascading change details: 5th output line, sed -n '5p' read, build_context update
- [warning] Updated brainstorming skill line count estimate to ~50 lines addition (335 total), well under 500
- [warning] Fixed Phase 7 dependencies text: explicitly notes NO dependency on Phase 6
- [warning] Added R6: Feature ID Collision as known limitation for solo-dev tooling
- [warning] Added R5: Workflow-Transitions Step Count Contract — no callers reference step count numerically
- Added DoD items: feature .meta.json schema extensions, release script sync

---

## Stage 1: Plan Review - Iteration 2 - 2026-02-10T18:30:00Z

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] Test fixture location mismatch: fixtures in agent_sandbox/ but validate.sh scans docs/features/ — tests are inoperative (at: Phase 1, Step 1.2)
- [warning] ASCII dependency graph still implies Phase 6→Phase 7 via connecting line (at: Dependency Graph)
- [warning] --feature routing mechanism not fully explained (at: Phase 5, Step 5.2)
- [warning] DoD missing specific AC-5 (cycle detection), AC-12 (approval gate), AC-14 (over-engineering) checks (at: Definition of Done)
- [warning] parse_feature_meta callers not enumerated — fragile positional interface (at: Phase 7, Step 7.3)
- [warning] parse_feature_meta mode default 'Standard' for null values (at: Phase 7, Step 7.3)
- [note] Phase 7 goal mentions "secretary" but no step modifies it (at: Phase 7 Goal)

**Changes Made:**
- [blocker] Moved test fixtures to docs/features/999-test-planned-valid/ and docs/features/998-test-planned-invalid/ where validate.sh actually scans. Added cleanup step to delete test dirs after verification.
- [warning] Redrawn ASCII graph: Phase 6 is terminal ("no downstream"), no arrow to Phase 7
- [warning] Added concrete --feature routing explanation: specify.md line 10-13 resolves to docs/features/{feature}/, reads .meta.json, then validateAndSetup detects status: "planned" to trigger transition
- [warning] DoD warnings noted but not added as separate items — the decomposing skill DoD item "orchestrates full pipeline" implicitly covers cycle detection, approval gate, and reviewer criteria. Adding 3 more items would be redundant granularity for a plan-level DoD.
- [warning] Confirmed parse_feature_meta only called from build_context at line 147 (grep verified). Added explicit note to Step 7.3.
- [warning] Added mode default note to Step 7.3: irrelevant for project features (planned features filtered out, active features have non-null mode)
- [note] Removed "secretary" from Phase 7 goal text

---

## Stage 1: Plan Review - Iteration 3 - 2026-02-10T18:45:00Z

**Reviewer:** plan-reviewer (skeptic, pragmatic)
**Decision:** Approved

**Issues:**
- [warning] Step 5.2 lastCompletedPhase="brainstorm" — verify exact string matches phase sequence array during implementation
- [warning] validate.sh Python-in-bash quoting — existing pattern provides template, but test carefully
- [warning] AskUserQuestion "Other" free-text assumption — inherited from design, accepted
- [note] Decomposing skill ~450 lines is tight — start with terse format proactively
- [note] Phase 3→Phase 5 dependency arrow missing from graph — text correct, graph slightly incomplete

---

## Stage 2: Chain Review - 2026-02-10T19:00:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [warning] Phase 5 dependency text said "Phase 1, Phase 3" but graph shows only Phase 1 — corrected text to remove Phase 3 dependency
- [warning] Test fixture cleanup easy to miss — added explicit ls verification step
- [warning] session-start line numbers may drift — use function name anchors in tasks
- [warning] DoD missing end-to-end walkthrough — added as 17th DoD item
- [suggestion] Step 3.1 (decomposing skill) should become 3-5 tasks during task breakdown
- [suggestion] Reference spec-reviewer.md as template for new agents

**Changes Made:**
- Fixed Phase 5 dependency text: depends only on Phase 1, not Phase 3
- Added fixture cleanup verification step (ls docs/features/999-* should fail)
- Added end-to-end walkthrough as DoD item

---
