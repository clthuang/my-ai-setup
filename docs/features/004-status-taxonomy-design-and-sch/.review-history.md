# Review History: 004-status-taxonomy-design-and-sch

## Step 1: Spec-Reviewer Review - Iteration 1 - 2026-03-01T16:55:00+08:00

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [assumptions] OQ-1, OQ-2, OQ-3 unresolved — affect schema design; must be firm decisions not recommendations
  Suggestion: Resolve all three OQs as firm decisions with rationale
- [blocker] [testability] AC-6 row cardinality undefined — `started`/`completed` semantics unclear for single-row model
  Suggestion: After resolving OQ-2, revise AC-6 to define row semantics
- [blocker] [traceability] AC-7 maps only 5 fields — real .meta.json has 15+ fields including design.stages.*, project_id, branch, etc.
  Suggestion: Enumerate ALL .meta.json fields with disposition
- [blocker] [clarity] AC-2/AC-6 NULL handling ambiguous — CHECK constraint with NULL needs explicit treatment
  Suggestion: Explicitly state whether workflow_phase is nullable or uses sentinel value
- [warning] [testability] AC-4 event vocabulary incomplete — missing phase_complete, phase_blocked, cancelled, etc.
  Suggestion: Enumerate complete list of workflow events that trigger kanban_column changes
- [warning] [assumptions] AC-6 FK provisional note missing — UUID migration may change PK
  Suggestion: Add explicit note about FK being based on current schema v1
- [warning] [scope] AC-7 status→kanban_column mapping rules undefined
  Suggestion: Add explicit mapping: planned→backlog, active→wip, completed→completed, abandoned→completed
- [warning] [testability] AC-5 entity type defaults not specified
  Suggestion: Define expected behavior for each entity type explicitly
- [warning] [clarity] AC-3 naming inconsistency with PRD (WIP vs wip, agent review vs agent_review)
  Suggestion: Confirm lowercase underscore values are canonical; display labels are UI concern

**Changes Made:**
Revising spec to address all blockers and warnings.

---

## Step 1: Spec-Reviewer Review - Iteration 2 - 2026-03-01T17:15:00+08:00

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [traceability] AC-7 missing `backlog_source` field — at least 5 features use it; provenance lineage from backlog items to features
  Suggestion: Add row with disposition (stays in .meta.json or maps to entities)
- [blocker] [traceability] AC-7 missing per-phase review sub-fields — `taskReview.*`, `chainReview.*`, `reviewIterations`, `approved`, `phases.finish.status` present in real .meta.json data
  Suggestion: Add explicit rows for all per-phase review sub-structures, deferred to feature 008
- [warning] [testability] Abandoned vs completed state indistinguishable — both map to kanban_column=completed, no explicit mechanism to tell them apart
  Suggestion: Add inference rule or explicit column for terminal disposition
- [warning] [assumptions] Per-entity-type kanban column restrictions not enforceable by DDL — CHECK constraints cannot reference entity_type
  Suggestion: Explicitly state enforcement layer (application-level via feature 008)
- [warning] [clarity] AC-4 phase_complete target "or remains" is ambiguous
  Suggestion: Replace with explicit rules for auto-start vs await scenarios
- [warning] [testability] AC-8 invalid scenarios lack enforcement layer specification
  Suggestion: Specify CHECK constraint vs trigger vs application validation for each scenario

**Changes Made:**
Revising spec to address all blockers and warnings.

---

## Step 1: Spec-Reviewer Review - Iteration 3 - 2026-03-01T17:30:00+08:00

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved with warnings

**Issues:**
- [warning] [clarity] AC-8 scenarios #3 and #6 show identical column values with opposite validity — readability concern
  Suggestion: Add cross-reference parenthetical to scenario #3
- [warning] [assumptions] AC-4 phase_complete event precedence for finish phase unstated
  Suggestion: Add note that finish phase completion triggers feature_completed instead
- [suggestion] [clarity] Abandoned inference rule not SQL-safe for NULL workflow_phase
  Suggestion: Use (workflow_phase IS NULL OR workflow_phase != finish)

**Changes Made:**
Addressing 2 warnings and 1 suggestion for strict threshold compliance.

---

## Design Review - Iteration 1 - 2026-03-01T18:40:00+08:00

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [warning] [completeness] FK has no ON DELETE clause — implicit RESTRICT behavior not documented
  Suggestion: Add a comment in the DDL or a note in the ADR acknowledging the implicit ON DELETE RESTRICT behavior
- [warning] [completeness] `mode` column has no CHECK constraint despite TD-2 rationale applying
  Suggestion: Either add CHECK(mode IN ('standard', 'full') OR mode IS NULL) or explain why mode is unconstrained
- [warning] [consistency] Ambiguity about what feature 004 delivers — ADR only vs ADR + Python code
  Suggestion: Clarify that feature 004 delivers ONLY the ADR document
- [warning] [assumptions] "workflow_phase as source of truth" claim not expressed in schema
  Suggestion: Add a note stating primacy is an application-level invariant

**Changes Made:**
Addressing all 4 warnings: added ON DELETE RESTRICT comment to DDL, added CHECK constraint for mode, clarified deliverable boundary in Component 2 and Architecture Overview, added workflow_phase primacy note to design principles.

---

## Design Review - Iteration 2 - 2026-03-01T18:45:00+08:00

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved

**Issues:**
- [suggestion] [consistency] Component 2 Outputs line still reads as Python function output
  Suggestion: Rephrase to "DDL content specifying the migration"
- [suggestion] [completeness] Components 5-6 don't reproduce spec tables inline
  Suggestion: Add note or reproduce tables for self-containment

**Changes Made:**
No changes needed — zero blockers and zero warnings. PASS.

---

## Handoff Review - Iteration 1 - 2026-03-01T18:50:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision

**Issues:**
- [warning] Component 2 Outputs line names a Python function, creating momentary ambiguity about what feature 004 delivers
  Suggestion: Change to "DDL content embedded in ADR document (Python migration function is feature 005)"
- [suggestion] Components 5-6 don't embed full tables from AC-4 and AC-7 inline
  Suggestion: Embed complete tables for self-containment

**Changes Made:**
Addressing 1 warning: rephrased Component 2 Outputs to remove Python function reference.

---

## Step 2: Phase Review - Iteration 1 - 2026-03-01T17:45:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved with warnings

**Issues:**
- [warning] AC-4 phase_complete does not define what constitutes auto-start vs human-decision pause
  Suggestion: Enumerate which phases auto-start or state that all phases auto-start
- [warning] AC-5/AC-6 DDL allows all 8 kanban values for all entity types without explicit acknowledgment
  Suggestion: State that DDL intentionally allows all values and restriction is delegated to feature 008
- [suggestion] skippedPhases intentionally absent from AC-6 schema not stated
  Suggestion: Add note confirming skipped_phases is feature 008's responsibility

**Changes Made:**
Addressing 2 warnings and 1 suggestion.

---

## Step 1: Plan Review - Iteration 1 - 2026-03-01T19:05:00+08:00

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [warning] [assumption] Appendix G field discovery lacks concrete grep step — spec was caught twice for missing fields
  Suggestion: Add explicit grep-based discovery substep to scan real .meta.json files
- [warning] [assumption] Project-level .meta.json fields (expected_lifetime) not in scope — spec says "ALL fields" but plan unclear on boundary
  Suggestion: Clarify scope: feature/brainstorm fields covered, project fields excluded per AC-5
- [warning] [assumption] backward_transition_reason column has no corresponding event in event map — gap unexplained
  Suggestion: Add note that backward transitions are state engine events, not distinct kanban-column-changing events
- [warning] [dependency] Stage 3.6 (conflicts) references DDL enforcement but shown parallel to Stage 3.5 in dependency graph
  Suggestion: Show 3.5 -> 3.6 dependency in graph
- [warning] [feasibility] Stage 4.1 consistency check lacks mechanical verification method
  Suggestion: Use grep/diff to extract and compare enum values from DDL and appendices

**Changes Made:**
Addressing all 5 warnings: added grep discovery substep and project scope note to Stage 3.7, backward transition note to Stage 3.3, fixed dependency graph 3.5→3.6, added mechanical verification to Stage 4.1.

---

## Step 1: Plan Review - Iteration 2 - 2026-03-01T19:15:00+08:00

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Approved

**Issues:**
- [suggestion] [clarity] Definition of Done line 179 still says '25+ .meta.json fields' while Stage 3.7's verification now says 'Field count matches grep discovery output'
  Suggestion: Consider changing to 'All discovered .meta.json fields with explicit disposition (AC-7)'

**Changes Made:**
No changes needed — zero blockers and zero warnings. PASS.

---

## Step 2: Phase Review - Iteration 1 - 2026-03-01T19:20:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [suggestion] [completeness] Stage 3.7 pre-step instructs engineer to 'grep all .meta.json files' but provides no concrete shell command
  Suggestion: Add exact command for verbatim execution

**Changes Made:**
No changes needed — zero blockers and zero warnings. PASS.

---

## Task Review Iteration 1 - 2026-03-01T19:35:00+08:00

**Decision:** Needs Revision

**Issues:**
- [blocker] T1: Test command uses relative path `adr-004-status-taxonomy.md` — fails if engineer not in correct directory -> Use full path `docs/features/004-status-taxonomy-design-and-sch/adr-004-status-taxonomy.md`
- [warning] T2-T16: Files field omits directory path — engineer must refer back to T1 -> Use full path in every task's Files field
- [warning] T13: Placed in Group 4 but only depends on T6 (Group 3) — unnecessarily delays field discovery -> Move T13 to Group 3
- [warning] T13: Test is descriptive not executable — no binary pass/fail command -> Add concrete grep verification commands

**Changes Made:**
Fixed T1 test to use full path. Applied full paths to all Files fields via replace_all. Moved T13 to Group 3. Added executable grep verification to T13 test. Also applied 2 suggestions: T3 test precision (parenthetical AC/TD refs), T16 dynamic date.

---

## Task Review Iteration 2 - 2026-03-01T19:45:00+08:00

**Decision:** Approved

**Issues:**
- [suggestion] T13: Test requires 'Total distinct key count should be 15+' but no executable command to verify count
- [suggestion] Group 3 description: T13 depends on T6 but group header implies full parallelism

**Changes Made:**
No changes needed — zero blockers and zero warnings. PASS.

---

## Step 2: Chain Review - Iteration 1 - 2026-03-01T19:50:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [suggestion] T13 dependency on T6 is not logically required — T13 could depend directly on T5

**Changes Made:**
No changes needed — zero blockers and zero warnings. PASS.

---

## Iteration 1 - 2026-03-01T20:30:00+08:00

**Implementation Review:** Approved
  - Level 1 (Tasks): pass
  - Level 2 (Spec): pass
  - Level 3 (Design): pass
  - Level 4 (PRD): pass
**Quality Review:** Issues found
**Security Review:** Approved

**Issues:**
- [warning] [readability] code-quality-reviewer: Appendix G 60-row flat table is hard to scan — disposition action not visually grouped (at: adr-004-status-taxonomy.md Appendix G)
  Suggestion: Split into sub-tables by disposition action
- [suggestion] [formatting] code-quality-reviewer: Minor dash inconsistency in deferred rows
- [suggestion] [flow] code-quality-reviewer: Decision Outcome missing lead sentence before bullet list
- [suggestion] [readability] code-quality-reviewer: Auto-start semantics repeated in Appendix C and Appendix D
- [suggestion] [config] security-reviewer: FK comment says "ON DELETE RESTRICT" but SQLite default is "ON DELETE NO ACTION" — semantics differ for deferred constraints
- [suggestion] [config] security-reviewer: Consider documenting which application component will own write access to workflow_phases
- [suggestion] [exposure] security-reviewer: backward_transition_reason is free-text — consider max length if exposed in UI

**Changes Made:**
Split Appendix G into 'Fields with Action in This Feature' (18 rows) and 'Fields Deferred to Feature 008' (34 rows) for scannability. Corrected FK comment from ON DELETE RESTRICT to NO ACTION (SQLite default). Collapsed design.stages.* into single row.

---

## Iteration 2 - 2026-03-01T20:45:00+08:00

**Implementation Review:** Skipped (passed iter 1)
**Quality Review:** Approved
**Security Review:** Skipped (passed iter 1)

**Issues:**
- [suggestion] [formatting] code-quality-reviewer: Appendix G sub-table rows could be grouped by disposition type
- [suggestion] [readability] code-quality-reviewer: design.md FK comment still says RESTRICT vs ADR's NO ACTION

**Changes Made:**
No changes needed — zero blockers and zero warnings. PASS.

---

## Iteration 3 - 2026-03-01T21:00:00+08:00 [FINAL VALIDATION]

RESUME-FALLBACK: implementation-reviewer iteration 3 — agent_id lost (context compaction)
RESUME-FALLBACK: code-quality-reviewer iteration 3 — agent_id lost (context compaction)
RESUME-FALLBACK: security-reviewer iteration 3 — agent_id lost (context compaction)

**Implementation Review:** Issues found
  - Level 1 (Tasks): pass (1 warning — T11 FK comment deviation from design.md)
  - Level 2 (Spec): pass
  - Level 3 (Design): pass (1 warning — design.md FK comment factually incorrect)
  - Level 4 (PRD): pass
**Quality Review:** Approved
**Security Review:** Approved

**Issues:**
- [warning] [tasks] implementation-reviewer: T11 FK comment changed from "ON DELETE RESTRICT" (design.md:131) to "ON DELETE NO ACTION" (ADR:169) — ADR is more accurate but deviates from task instruction "Copy DDL exactly" (at: adr-004-status-taxonomy.md:169)
  Suggestion: Update design.md to match ADR, since ADR is correct per SQLite docs
- [warning] [design] implementation-reviewer: design.md Interface 1 FK comment says "ON DELETE RESTRICT (SQLite default)" which is factually incorrect — SQLite default is NO ACTION (at: design.md:131)
  Suggestion: Update design.md line 131 from RESTRICT to NO ACTION
- [suggestion] [formatting] code-quality-reviewer: Appendix G sub-table rows could be grouped by disposition type
- [suggestion] [config] security-reviewer: design.md, plan.md, tasks.md still reference old RESTRICT wording

**Changes Made:**
Updated design.md FK comment from "ON DELETE RESTRICT" to "ON DELETE NO ACTION" to match ADR and SQLite documentation.

---

## Iteration 4 - 2026-03-01T21:15:00+08:00

RESUME-FALLBACK: implementation-reviewer iteration 4 — agent_id lost (context compaction)

**Implementation Review:** Approved
  - Level 1 (Tasks): pass
  - Level 2 (Spec): pass
  - Level 3 (Design): pass
  - Level 4 (PRD): pass
**Quality Review:** Skipped (passed iter 3)
**Security Review:** Skipped (passed iter 3)

**Issues:**
None — zero blockers, zero warnings across all levels.

**Changes Made:**
No changes needed — zero blockers and zero warnings. PASS.

---
