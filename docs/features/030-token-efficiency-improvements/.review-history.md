# Review History — Feature 030: Token Efficiency Improvements

## Design Review - Iteration 1 - 2026-02-27T19:00:00+08:00

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [feasibility] GitHub #13619: Task tool resume fails with 400 error when subagent used tools
- [blocker] [completeness] PRD/brainstorm conditional not handled in lazy-load references
- [warning] [completeness] Brainstorming skill scope exclusion not stated
- [warning] [completeness] No-PRD case for direct create-feature features not handled
- [warning] [consistency] I7 language inconsistency with TD1
- [warning] [consistency] Implementer fix dispatch key naming confusion
- [warning] [assumptions] Delta size guard 50% threshold may be miscalibrated

**Changes Made:**
- Restructured architecture: R1 (resume) deferred to Phase 2, R2+R3 as Phase 1
- Added I8 (PRD Resolution Logic) with 3-step resolution function
- Added I9 (Lazy-Load Fallback Detection)
- Made I2, I3, I6 forward-compatibility definitions only
- Added exclusion notes for brainstorming skill and Stage 0 research agents
- Added TD5 for consistent mandatory language

---

## Design Review - Iteration 2 - 2026-02-27T19:20:00+08:00

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved with warnings

**Issues:**
- [warning] [consistency] PRD section-scoping loss for test-deepener (full file vs Problem Statement + Goals)
- [warning] [completeness] I8 step 3a is dead code (brainstorm features always copy prd.md)
- [warning] [completeness] I1 Implementation Files section should be conditional for phase commands
- [warning] [feasibility] Grep audit false positives from non-artifact content injection patterns

**Changes Made:**
- Added inline comment in I4 for test-deepener full PRD read justification
- Added defensive-fallback comment to I8 step 3a
- Made I1 Implementation Files section conditional (implement.md dispatches only)
- Added Verification Note for grep audit false positives

---

## Design Review - Iteration 3 - 2026-02-27T19:40:00+08:00

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved with warnings

**Issues:**
- [warning] [consistency] code-simplifier losing spec.md for YAGNI — spec-level decision, not design flaw
- [warning] [completeness] I9 fallback detection is observational-only with no corrective action
- [warning] [consistency] Artifact-under-review convention implicit in I5
- [warning] [completeness] prd.md section-scoping loss in I7 for implementer dispatches

**Changes Made:**
- Added NFR2 escalation comment in I4 code-simplifier entry
- Expanded I9 description with multi-reviewer redundancy rationale
- Added explicit artifact-under-review note above I5
- Added note in I7 about intentional full-PRD simplification

---

## Design Review - Iteration 4 - 2026-02-27T20:00:00+08:00

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved with warnings

**Issues:**
- [warning] [consistency] I5 review-target vs upstream-context distinction needs implementer guidance
- [warning] [completeness] NFR2 fallback_count persistence across features unspecified
- [warning] [consistency] R3 pruning is behavioral change, not just transport — constraint imprecision

**Changes Made:**
- Added explicit implementer instruction to I5 note
- Added cross-feature accumulation grep command to I9
- Added TD5b documenting R3 as intentional behavioral adjustment

---

## Stage 4: Handoff Review - Iteration 1 - 2026-02-27T20:35:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision

**Issues:**
- [warning] File Change Summary I9 scope ambiguous — not all files listed I9 explicitly
- [warning] No PRD sentinel example missing from I8

**Changes Made:**
- Added I9 fallback detection to all 6 file rows in File Change Summary
- Added concrete PRD sentinel example to I8
- Clarified I9 execution order (before JSON parsing)

---

## Stage 4: Handoff Review - Iteration 2 - 2026-02-27T20:45:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision

**Issues:**
- [warning] I9 fallback_count wording implies separate variable but none defined

**Changes Made:**
- Replaced "Increment fallback_count" with "LAZY-LOAD-WARNING entry constitutes the NFR2 tracking record"
- Added implementation order suggestion to File Change Summary

---

## Stage 4: Handoff Review - Iteration 3 - 2026-02-27T20:55:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision

**Issues:**
- [warning] Step 7e implement.md dispatch not clearly mapped to I1/I4
- [warning] Phase 2 planning boundary unclear — planner may create tasks for I2/I3/I6

**Changes Made:**
- Added parenthetical clarifying step 7e uses I1 with "implementer" key from I4
- Added explicit Phase 2 planning exclusion statement
- Added specific retained extractSection patterns to Verification Note

---

## Stage 4: Handoff Review - Iteration 4 - 2026-02-27T21:05:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:**
- [suggestion] Shared helper extraction strategy not stated
- [suggestion] Retrospecting/SKILL.md not in File Change Summary exclusion list

**Changes Made:**
None required — suggestions only.

---

## Design Review - Iteration 5 - 2026-02-27T20:20:00+08:00

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved with warnings (iteration cap reached)

**Issues:**
- [warning] [consistency] TD5b should document test-deepener PRD expansion alongside code-simplifier
- [warning] [completeness] I9 fallback detection scope ambiguous across commands
- [warning] [consistency] N-reads tradeoff for spec/prd in per-task implementer dispatches not acknowledged

**Changes Made:**
- Expanded TD5b to document both code-simplifier and test-deepener changes
- Added I9 scope clarification: applies to all 6 in-scope files
- Added N-reads tradeoff note to TD4
- Added implementing skill's retained extractSection to Verification Note

---

## Stage 1: Plan Review - Iteration 1 - 2026-02-27T21:20:00+08:00

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [assumption] Steps 1F.4/1F.5 do not clearly acknowledge R3 pruning behavioral changes (removing 3 artifacts from code-quality/security reviewers)
- [blocker] [failure-mode] No "Why this item" / "Why this order" rationale on any step
- [warning] [assumption] Review-target transport mechanism unclear — "keep inline" not defined
- [warning] [failure-mode] I9 fallback detection on non-reviewer action agents may produce frequent warnings
- [warning] [dependency] Test-deepener Phase B exclusion from conversion not explicitly stated
- [warning] [failure-mode] Grep audit false positive list inaccurate after SKILL.md conversion
- [warning] [tdd-order] No manual end-to-end validation step in plan
- [warning] [assumption] Premature removal of "always a NEW Task" directive loses documentation

**Changes Made:**
- Added Conventions section: review-target transport, R3 pruning acknowledgment, I9 for action agents, "always a NEW Task" replacement, batch note
- Added "Why this item" / "Why this order" rationale to every phase
- Added explicit "R3 pruning change" labels to Steps 1F.1, 1F.2, 1F.4, 1F.5
- Clarified review-target stays orchestrator-injected inline (not lazy-loaded)
- Added Phase B exclusion note to Step 1F.2
- Refined grep audit false positive list (only brainstorming/SKILL.md and retrospecting/SKILL.md)
- Added Step 1G.3: Manual end-to-end validation
- Replaced "Remove 'always a NEW Task'" with replacement directive text

---

## Stage 1: Plan Review - Iteration 2 - 2026-02-27T21:30:00+08:00

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Approved with warnings

**Issues:**
- [warning] [assumption] PRD pattern variance between implement.md and phase commands not acknowledged
- [warning] [assumption] Step 1G.2 agent frontmatter check success criteria imprecise
- [warning] [failure-mode] I9 insertion point within control flow not specified

**Changes Made:**
- Added "PRD conditional pattern variance" convention explaining both patterns map to I8
- Added "I9 insertion point" convention: after response, before JSON parsing
- Refined Step 1G.2 to list all 11 specific agents from I4/I5
- Changed grep -rP to grep -rE for macOS compatibility
- Clarified batch note: numbering is readability, not dependency

---

## Stage 1: Plan Review - Iteration 3 - 2026-02-27T21:40:00+08:00

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Approved with warnings

**Issues:**
- [warning] [assumption] brainstorming/SKILL.md incorrectly listed as grep false positive (won't match pattern)
- [warning] [assumption] Grep audit misses section-scoped PRD injection patterns

**Changes Made:**
- Removed brainstorming/SKILL.md from false positive list; kept only retrospecting/SKILL.md
- Added secondary grep pattern for section-scoped PRD patterns

---

## Stage 1: Plan Review - Iteration 4 - 2026-02-27T21:50:00+08:00

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Approved with warnings

**Issues:**
- [warning] [assumption] "Always a NEW Task" is parenthetical in prose, not standalone — replacement needs to preserve surrounding text
- [warning] [assumption] implement.md has no "always a NEW Task" directive — convention should not imply it applies there
- [warning] [failure-mode] Secondary grep should expect zero matches from both implement.md and SKILL.md after conversion
- [warning] [assumption] Primary grep coverage gap for section-scoped PRD — already covered by secondary grep

**Changes Made:**
- Clarified "Always a NEW Task" convention: parenthetical in 4 phase commands only, not implement.md
- Added expected zero matches note to secondary grep verification
- No change for primary grep gap (secondary grep already covers it, reviewer acknowledged)

---

## Stage 2: Chain Review - Iteration 1 - 2026-02-27T21:20:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision

**Issues:**
- [blocker] Plan steps not fully visible in prompt — reviewer received compressed summary instead of full plan.md content
- [blocker] Design interfaces (I1, I4, I5, I7, I8, I9) referenced by label only — reviewer could not see definitions
- [warning] R3 pruning counts don't name specific artifacts removed per step
- [warning] 1G verification doesn't specify grep patterns, agent list, or e2e criteria

**Changes Made:**
- All issues were caused by prompt compression in the previous session, not actual plan.md deficiencies. The full plan.md (252 lines) contains all 16 steps with file paths, actions, traceability, R3 pruning details with specific artifact names, and 1G verification with exact grep patterns and all 11 agent names.
- Re-dispatching with complete plan.md content.

---

## Stage 2: Chain Review - Iteration 2 - 2026-02-27T22:00:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved with warnings

**Issues:**
- [warning] Steps 1F.1-1F.6 prose says "not technically dependent" but they target the same file — contradiction with dependency chain
- [warning] "No I8 needed" notes in 1F.1, 1F.4, 1F.5 are ambiguous about whether I8 is a missing step or intentional omission
- [suggestion] 1A gate is soft — task-executor could bypass de-risking by starting 1B-1E before 1A confirmed

**Changes Made:**
- Replaced "not technically dependent" prose with "must be executed sequentially (same file)"
- Replaced "No I8 needed (no PRD in mapping)" with explicit clarification in all 3 steps (1F.1, 1F.4, 1F.5)

---

## Stage 2: Chain Review - Iteration 3 - 2026-02-27T22:10:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved with warnings

**Issues:**
- [warning] Step 1G.1 grep audit lists only 1 expected false positive but design Verification Note lists 3 (retrospecting, brainstorming, implementing extractSection)
- [warning] "Always a NEW Task" directive replacement defined in Conventions but step bullets say vague "Phase 1/2 directive comment" instead of exact replacement text

**Changes Made:**
- Expanded Step 1G.1 to list all 3 expected remaining matches with rationale
- Replaced vague "Phase 1/2 directive comment" in all step bullets with exact replacement text from Convention

---

## Stage 2: Chain Review - Iteration 4 - 2026-02-27T22:20:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved with warnings

**Issues:**
- [warning] "Add I9" instruction lacks reference to where the exact I9 template text lives in the design
- [warning] Step 1G.2 agent frontmatter check doesn't state its purpose or pass/fail criteria
- [suggestion] 1F sequential constraint could note these are a single editing pass, not separate saves

**Changes Made:**
- Added "See Design I9 (`check_artifact_confirmation` function) for the verbatim check to insert" to I9 Convention
- Added Purpose and Pass/fail lines to Step 1G.2

---

## Stage 2: Chain Review - Iteration 5 - 2026-02-27T22:30:00+08:00

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved (iteration cap reached)

**Issues:**
- [warning] Overview says "16 steps" but actual count is 18 (1+8+6+3)
- [suggestion] Step 1A.1 lacks explicit done-when signal
- [suggestion] Step 1F.2 Phase B exclusion could say "leave unchanged"

**Changes Made:**
- Fixed step count in overview (16→18, 13→15 conversion steps)
- Suggestions noted but not blocking — proceeding to completion

---
