# Review History: 022-context-and-review-hardening

## Stage 1: Spec-Reviewer Review - Iteration 1 - 2026-02-13T13:00:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [specificity] Plan.md extraction rule unspecified — what is "plan item 3.2" structurally? (at: AC-2, Scope)
  Suggestion: Specify the structural format of plan items and extraction rules
- [blocker] [evidence] Feature 020 contradicts Why/Source coverage claim — post-017 but has no traceability fields (at: Feasibility Assessment)
  Suggestion: Acknowledge as counterexample, confirm fallback path is real
- [warning] [testability] AC-9 untestable without live project (at: AC-9)
  Suggestion: Add verification approach that doesn't require live project
- [warning] [completeness] Task ordering in dispatch loop unspecified (at: AC-1, Scope)
  Suggestion: Specify sequential in document order
- [warning] [specificity] Heading matching should be specified, not open question (at: Open Questions 2)
  Suggestion: Promote to specified behavior with substring containment
- [warning] [completeness] Open questions 1-2 on critical path — should be resolved (at: Open Questions)
  Suggestion: Resolve or explicitly defer to design
- [warning] [completeness] Missing SC for spec.md full loading (at: Success Criteria)
  Suggestion: Add SC or fold into SC-2

**Changes Made:**
- Added Heading Extraction Rules to Scope section with substring matching, section boundary rules, and all known plan.md heading variants
- Added task ordering: "sequential in document order (top to bottom in tasks.md)" to Scope and AC-1
- Folded spec.md full loading into SC-2
- Acknowledged feature 020 as counterexample in Feasibility Assessment and Key Assumptions
- Added verification approach to AC-9 (code review of prompt construction, no live project required)
- Promoted Open Questions 1-2 to "Resolved Design Decisions" with concrete rules
- Renumbered remaining Open Questions

---

## Stage 1: Spec-Reviewer Review - Iteration 2 - 2026-02-13T13:15:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [assumptions] Feature 018 uses `Design § Component 2 § scqa-framing.md` format — unhandled by regex, omitted from verified features list (at: Resolved Design Decisions, Heading Extraction Rules)
  Suggestion: Add 018 to known non-matching variants, document as deliberate fallback
- [warning] [assumptions] Plan references at sub-heading granularity (1A.1) fail heading match when sub-items are bold text, not headings — silently degrades to full loading (at: Heading Extraction Rules)
  Suggestion: Add prefix fallback (1A.1 → try 1A) to match parent heading
- [warning] [assumptions] Comma-separated multi-reference values (e.g., `Spec C4.1, Plan 1A.1`) — splitting logic unspecified (at: Resolved Design Decisions, AC-4)
  Suggestion: Add explicit comma-split step before regex matching
- [warning] [testability] AC-9 deferred behavioral testing should be explicit (at: AC-9)
  Suggestion: Add "Full behavioral verification deferred to first project-linked feature"
- [warning] [clarity] SC-7 token budget undefined — "compact" means nothing without numbers (at: SC-7)
  Suggestion: Move ~200-500 token spec from AC-9 into SC-7
- [warning] [traceability] Knowledge bank "retire" action unspecified — what happens when user selects retire? (at: AC-18)
  Suggestion: Specify retire/keep/update outcomes

**Changes Made:**
- Added feature 018 to known non-matching variants in Resolved Design Decisions and Feasibility Assessment
- Added prefix fallback rule (1A.1 → 1A) to Heading Extraction Rules
- Added "Traceability Field Parsing" section with explicit comma-split step before regex matching
- Added deferred testing note to AC-9
- Moved token budget specification into SC-7 with breakdown (~200 base, ~100 per dependency)
- Added retire/keep/update action specifications to AC-18
- Added Implementation-log.md Entry Template to Scope
- Added Primary Modification Targets listing all files to change

---

## Stage 1: Spec-Reviewer Review - Iteration 3 - 2026-02-13T13:30:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved (with 4 warnings, 2 suggestions — no blockers)

**Issues:**
- [warning] [assumptions] Heading extraction feasibility listed as "Likely" without citing concrete heading examples (at: Feasibility Assessment)
  Suggestion: Cite 2-3 actual heading examples from different features
- [warning] [testability] SC-13 knowledge bank validation quality is subjective — LLM judgment (at: SC-13, AC-16/17)
  Suggestion: No change needed, but first retro run should be manually reviewed
- [warning] [clarity] PRD section extraction mechanism unspecified — how to extract Problem Statement + Goals from prd.md (at: In Scope line 35)
  Suggestion: Add exact heading text match clarification
- [warning] [traceability] Missing AC for no-domain-reviewer edge case from PRD edge case table (at: AC-11/12)
  Suggestion: Add to Resolved Design Decisions documenting intent

**Changes Made:**
- Upgraded heading extraction assumption from "Likely" to "Verified across known variants" with concrete examples (017, 019, 020, 021)
- Added manual review calibration note to SC-13
- Added PRD section extraction mechanism (exact heading text match for "Problem Statement" and "Goals")
- Added Resolved Design Decision #3: Domain Reviewer Outcome block presence (only when domain reviewer invoked)
- Added design identifier format examples (C9, Auth-Module, R-1, I-4) to regex description

---

## Stage 1: Spec-Reviewer Review - Iteration 4 - 2026-02-13T13:45:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved (with 3 warnings, 1 suggestion — no blockers)

**Issues:**
- [warning] [testability] AC-9 deferred verification has no mechanism to ensure it happens (at: AC-9)
  Suggestion: Add explicit deferred behavioral verification checkpoint
- [warning] [testability] SC-13 calibration criteria unspecified — what constitutes acceptable match quality (at: SC-13)
  Suggestion: Specify no false positives, no obvious false negatives, challenge text specific and actionable
- [warning] [assumptions] Heading extraction wording conflates "extraction works" with "fallback works" (at: Feasibility Assessment)
  Suggestion: Distinguish extraction accuracy (4/5) from fallback reliability (5/5)

**Changes Made:**
- Added deferred behavioral verification section to AC-9 (first project-linked feature confirms correct content)
- Specified SC-13 calibration criteria (no false positives, no obvious false negatives, challenge text specific and actionable)
- Reworded heading extraction assumption to distinguish extraction accuracy (4/5) from fallback reliability (5/5)

---

## Stage 2: Phase Review - Iteration 1 - 2026-02-13T14:00:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved (with 3 warnings, 2 suggestions — no blockers)

**Issues:**
- [warning] [completeness] Retro-facilitator Step 2 prompt template not mentioned as needing update for implementation-log section (at: Scope)
  Suggestion: Add note about Step 2 prompt template change
- [warning] [clarity] SC-7 project context sizing undefined for large dependency lists (at: SC-7, AC-9)
  Suggestion: Note as design-phase decision whether to cap at ~500 tokens
- [warning] [clarity] SC-7 reads as behavioral criterion but verified via code review only (at: SC-7, AC-9)
  Suggestion: Reword SC-7 to reflect code-review verification

**Changes Made:**
- Added retro-facilitator Step 2 prompt template update note to scope
- Reworded SC-7 to "have code paths to receive" and added design-phase cap decision note

---

## Stage 2: Phase Review - Iteration 2 - 2026-02-13T14:15:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved (zero issues)

**Summary:** Spec is comprehensive and ready for design. All 16 SCs measurable, all 21 ACs use Given/When/Then format, scope boundaries exhaustive, domain reviewer approved at iteration 4/5 with no unresolved issues.

---

## Design Review - Iteration 1 - 2026-02-13T15:00:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [completeness] Aggregate output from per-task loop to implement.md Steps 5-6 unspecified (at: Component 1)
  Challenge: What data structure flows from implementing skill back to implement.md Step 5 and 6?
- [blocker] [consistency] File Modification Summary says "implement.md: No change" but spec lists it as Primary Modification Target (at: File Modification Summary vs Spec line 66)
  Challenge: Does implement.md need changes or not?
- [warning] [consistency] Plan regex only handles two-level identifiers; three-level (1.2.3) would capture partial (at: Component 2, TD-2)
  Challenge: Acceptable limitation but undocumented
- [warning] [completeness] Domain Reviewer Outcome block insertion position not explicit enough (at: Component 7)
  Challenge: Where exactly in the 4 prompt templates?
- [warning] [feasibility] Knowledge bank validation instructions for retro agent unspecified (at: Component 5)
  Challenge: What mechanism and what criteria?
- [warning] [assumptions] depends_on_features field name unverified against feature 021 (at: Component 3)
  Challenge: Verified — field names match feature 021 design
- [warning] [completeness] Task regex captures trailing bold markers in title (at: Interface 1)
  Challenge: Regex needs post-processing for clean titles
- [suggestion] [completeness] Knowledge bank backfill edge cases: non-numeric provenance, Source vs Observed in (at: Component 9)
- [suggestion] [complexity] Implementing SKILL.md should be modified incrementally (at: File Modification Summary)

**Changes Made:**
- Added "Aggregate output to implement.md Steps 5-6" subsection to Component 1 specifying files changed union, task summary, and that Steps 5-6 continue with full artifacts
- Changed File Modification Summary: implement.md from "No change" to "Minor: Step 4 references updated implementing skill"
- Added "implement.md changes (minor)" subsection to Component 1 explaining Step 4 reference update and why Step 6d needs no template change
- Added TD-2 limitation note about two-level vs three-level identifiers with prefix fallback behavior
- Clarified Component 7 insertion: "immediately before ## Next Phase Expectations, after the last artifact section"
- Added knowledge bank validation mechanism explanation: performed by main orchestrating agent (not sub-agent), with concrete relevance/accuracy criteria
- Added field name verification note to Component 3 citing feature 021 design.md:482-484
- Fixed Interface 1 regex with post-processing step to strip bold markers
- Added detailed backfill rules for non-numeric provenance and Source vs Observed in field difference
- Added "(incremental: C1 first, then C2, then C3)" to implementing SKILL.md in File Modification Summary

---

## Design Review - Iteration 2 - 2026-02-13T15:15:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [warning] [consistency] Component 3 project context may duplicate workflow-transitions Step 5 context (at: Component 3)
  Challenge: What is the relationship between Step 5 phase-level context and Component 3 per-task context?
- [warning] [completeness] Domain Reviewer Outcome block has no full prompt template example shown (at: Component 7)
  Challenge: Implementer needs to know exact insertion point and surrounding prompt structure
- [warning] [assumptions] KB validation cognitive load on orchestrating agent after full retro workflow (at: Component 5)
  Challenge: Agent already performed AORTA analysis — is validation bounded enough to be reliable?
- [warning] [feasibility] Task regex robustness — implementers should test against actual tasks.md (at: Interface 1)
  Challenge: FYI that the regex pattern should be verified during implementation
- [suggestion] [completeness] File count inconsistency (12 in overview vs 14 in table) (at: Architecture Overview)
- [suggestion] [complexity] C1 can ship independently of C2/C3 (at: File Modification Summary)

**Changes Made:**
- Added "Relationship to workflow-transitions Step 5" clarification to Component 3 explaining distinct injection points
- Added full prompt template example to Component 7 showing Domain Reviewer Outcome block in specify.md context
- Added "Cognitive load note" to Component 5 explaining bounded nature of validation after AORTA analysis
- Added "Robustness note" to Interface 1 documenting testing requirement and failure mode

---

## Design Review - Iteration 3 - 2026-02-13T15:30:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [assumptions] C1 Task Block Parser regex matches zero actual tasks.md files — real format is heading-based (`### Task N.N:` / `#### Task N.N:`), not checkbox-based (`- [ ] **Task N:**`) (at: Component 1, Interface 1)
  Challenge: The parser would find zero tasks in any existing or template-generated tasks.md file
- [warning] [completeness] C1 references 'incomplete tasks (unchecked items)' but actual tasks.md has no checkboxes — completion detection mechanism undefined (at: Component 1)
  Challenge: How does the loop know which tasks are complete?
- [warning] [consistency] Task number assumes single integers but actual format uses dot-separated identifiers (1.1, 2.3) (at: Component 1, Interface 1)
  Challenge: Regex `(\d+)` doesn't capture dot-separated task numbers
- [warning] [completeness] KB validation context load on orchestrating agent needs escape hatch for future extraction (at: Component 5 Step 4b)
  Challenge: If context is tight, validation should be extractable to sub-agent
- [warning] [feasibility] Report extraction doesn't specify exact header patterns for new Decisions/Deviations fields (at: Component 4, Interface 3)
  Challenge: What exact patterns does the skill search for?
- [suggestion] [completeness] Staleness check field lookup should specify it always reads from 'Last observed', not original 'Source'/'Observed in' (at: Component 5/9)
- [suggestion] [completeness] Non-numeric provenance backfill should be marked as approximate (at: Component 9)

**Changes Made:**
- Rewrote Interface 1 Task Block Parser for heading-based format: `/^(#{3,4})\s+Task\s+(\d+(?:\.\d+)*):?\s*(.+)$/`
- Changed TaskBlock.number from `number` to `string` (dot-separated like "1.1")
- Removed checkbox references; task headings at `###` or `####` level per actual codebase
- Added completion tracking strategy: dispatch ALL tasks in order, implementer checks done criteria
- Updated C1 new behavior to use heading-based format
- Added escape hatch note to C5 cognitive load section for future sub-agent extraction
- Added specific report extraction patterns (substring match, case-insensitive) to Interface 3
- Added staleness field lookup clarification to Step 4b.d
- Marked non-numeric provenance backfill as approximate

---

## Design Review - Iteration 4 - 2026-02-13T15:45:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved (with 4 warnings, 2 suggestions — no blockers)

**Issues:**
- [warning] [consistency] New entry provenance field mixed format: heuristics.md uses 'Source' but new template uses 'Observed in' (at: Component 9, Interface 7)
  Challenge: Should the template be file-aware for per-file consistency?
- [warning] [completeness] File path deduplication in aggregate output is best-effort since paths are LLM-produced (at: Component 1)
  Challenge: How are file paths normalized across task reports?
- [warning] [assumptions] Plan regex verified against all known traceability formats — confirmation only (at: Component 2, TD-2)
  Challenge: Evidence verification, not a design issue
- [warning] [completeness] Step 4b should clarify that only pre-existing entries are validated, not entries just written in Step 4a (at: Component 5)
  Challenge: Newly written entries are inherently validated by this feature's experience

**Changes Made:**
- Added per-file provenance field note to Component 9 (use 'Observed in' for anti-patterns, 'Source' for heuristics)
- Clarified file path deduplication as best-effort string comparison in aggregate output
- Added Step 4b scope clarification: pre-existing entries only, distinguish from Step 4a entries

---

## Design Review - Iteration 5 - 2026-02-13T15:50:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved (with 2 informational warnings, 2 suggestions — no blockers)

**Issues:**
- [warning] [consistency] PRD-vs-design divergence: PRD says implementer agent appends to implementation-log.md, design says implementing skill does extraction and append — design is authoritative (at: Component 4 vs PRD Change 2)
- [warning] [completeness] Step 2 prompt template insertion point specified as "between Review History and Git Summary" — sufficient for implementation (at: Component 5)
- [suggestion] [feasibility] Backfill must ADD Last observed fields, not rename existing provenance fields (at: Component 9)
- [suggestion] [complexity] Non-numeric provenance approximate backfill well-documented (at: Component 9)

**Changes Made:**
- No changes required — both warnings explicitly state "no design change needed"

---

## Handoff Review - Iteration 1 - 2026-02-13T15:55:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision

**Issues:**
- [warning] PRD-vs-design divergence on implementation-log.md writer should have explicit Design Authority Note (at: Component 4)
  Suggestion: Add note clarifying skill writes to disk, not implementer agent
- [warning] KB validation inline trade-off acknowledged with escape hatch but no concrete signal for triggering it (at: Component 5)
  Suggestion: No change needed, document as monitoring point during first execution
- [warning] Dual-provenance convention (Source vs Observed in) adequately documented but plan should be aware (at: Component 9)
  Suggestion: Plan should create separate tasks for backfill per-file

**Changes Made:**
- Added Design Authority Note to Component 4 clarifying that implementing skill (not implementer agent) appends to implementation-log.md

---

## Handoff Review - Iteration 2 - 2026-02-13T16:00:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved (with 2 planner-actionable warnings — no blockers, no design changes needed)

**Issues:**
- [warning] implement.md Step 4 specific text changes to be determined at plan time (at: Component 1)
- [warning] KB validation sub-step should be self-contained atomic task in plan for future extractability (at: Component 5)

**Summary:** Design is comprehensive and ready for implementation planning. All 10 components well-defined with clear interfaces, pseudocode for key algorithms, and complete file modification summary. Both warnings are planner guidance, not design deficiencies.

---
