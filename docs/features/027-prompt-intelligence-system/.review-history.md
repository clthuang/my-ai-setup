# Review History: 027 Prompt Intelligence System

## Design Review - Iteration 1 - 2026-02-24T00:46:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [consistency] Internet-researcher output schema mismatch — 3 different schemas referenced
- [blocker] [completeness] Accept-some partial merge algorithm unspecified
- [blocker] [feasibility] component-authoring.md two-location Glob path unworkable from cache dir
- [warning] [completeness] Deduplication criteria undefined
- [warning] [completeness] Write target ambiguous for refresh command
- [warning] [completeness] Agent prompt too generic — missing search queries
- [warning] [completeness] Token budget check missing for improved version
- [warning] [completeness] "Section" definition ambiguous for accept-some
- [warning] [completeness] YOLO mode missing validate.sh note

**Changes Made:**
All 3 blockers and 6 warnings addressed: unified agent schema, defined CHANGE/END CHANGE delimiters, distilled component-authoring into seed, added deduplication heuristic, added Glob resolve + write-back, added specific search queries, added token budget check, defined section boundaries, added validate.sh note.

---

## Design Review - Iteration 2 - 2026-02-24T00:52:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision (approved: true, but 4 warnings under strict threshold)

**Issues:**
- [warning] [consistency] Skill name 'promptimize' vs gerund convention — validate.sh does not enforce gerund, acceptable exception
- [warning] [completeness] Search queries claimed missing — FALSE POSITIVE, queries exist at lines 216-224
- [warning] [feasibility] CHANGE/END CHANGE markers may be malformed by LLM — needs fallback
- [warning] [completeness] CHANGE marker format ambiguity — needs concrete example
- [warning] [assumptions] Skill token budget risk — behavioral anchors should move to references/
- [suggestion] [completeness] Dimension applicability matrix per component type
- [suggestion] [complexity] Strengths section generation rule
- [suggestion] [consistency] promptimize command naming — acceptable brand name

**Changes Made:**
Addressed 3 real warnings (skipped false positive on search queries): added concrete CHANGE block example, added malformed-marker fallback to Accept-all/Reject, moved behavioral anchors to references/scoring-rubric.md. Also added dimension applicability matrix and strengths generation rule (suggestions).

---

## Design Review - Iteration 3 - 2026-02-24T00:58:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision (approved: true, but 3 warnings under strict threshold)

**Issues:**
- [warning] [consistency] Spec-design divergence on component-authoring.md loading — spec says "loaded at runtime", design says "distilled into seed"
- [warning] [completeness] Guidelines file not found — refresh command has no error for missing Glob results
- [warning] [assumptions] Agent output parsing — internet-researcher may return unparseable output
- [suggestion] [completeness] Stub file guard — scoring near-empty files may confuse
- [suggestion] [feasibility] Guidelines growth — file may grow large over time

**Changes Made:**
Updated spec.md to match design decision (distilled at seed time, not runtime). Added Glob-not-found error to refresh command step 1. Added unparseable-output fallback to refresh command step 3. Suggestions noted as operational guidance.

---

## Handoff Review - Iteration 1 - 2026-02-24T01:02:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision (approved: true, but 2 warnings under strict threshold)

**Issues:**
- [warning] internet-researcher agent output format not specified — FALSE POSITIVE (specified at lines 14, 254, 404 of design.md)
- [warning] Inseparable block merge criterion undefined for Accept-some overlapping dimensions

**Changes Made:**
Added explicit line-range overlap criterion for inseparable block merging. False positive on agent output noted.

---

## Handoff Review - Iteration 2 - 2026-02-24T01:06:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision (approved: true, but 2 warnings)

**Issues:**
- [warning] Data flow between skill process steps implicit — addressed with explicit step 4→5→6 flow note
- [warning] Accept-some merge invariant unstated — added markdown validity invariant
- [suggestion] Implementation order constraint — added to Dependencies section

**Changes Made:**
Added data flow note to step 5, merge invariant to Accept-some, implementation order constraint to Dependencies.

---

## Handoff Review - Iteration 3 - 2026-02-24T01:10:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved (1 minor warning: section name inconsistency)

**Issues:**
- [warning] Persuasion Techniques section missing from refresh command preserved sections list — fixed
- [suggestion] Glob patterns not explicit for skill reference loading — added concrete patterns

**Changes Made:**
Added Persuasion Techniques to preserved sections list. Added concrete two-location Glob patterns for reference file loading.

---

## Stage 1: Plan Review - Iteration 1 - 2026-02-24T01:14:00Z

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] Dependency graph contradiction — item 5 described as both depending on and not depending on item 3
- [blocker] No TDD/intermediate verification step between skill creation (item 3) and final validation (item 7)
- [warning] Skill invocation format should be `Skill(skill: "iflow-dev:promptimize")`, not `Skill("promptimize")`
- [warning] Task tool invocation format ambiguous — should use `Task(subagent_type: ..., prompt: ...)`
- [warning] Accept-some merge safety verification missing from item 3 and item 7
- [warning] Cache persistence data-loss risk for refresh command writing to cache path
- [warning] Token budget 450-line fallback not concrete
- [warning] Secretary fast-path table may need updating for promptimize

**Changes Made:**
Fixed dependency graph: item 5 depends on items 1-2 only, NOT item 3. Added explicit per-item dependency explanations. Added intermediate smoke test to item 3 (run validate.sh after SKILL.md creation). Fixed Skill invocation format to `Skill(skill: "iflow-dev:promptimize", args: "<path>")`. Fixed Task invocation format to `Task(subagent_type: "iflow-dev:internet-researcher", prompt: "...")`. Added Accept-some merge verification to item 7. Added cache persistence note to item 5 with user guidance. Added 450-line target with concrete fallback (move CHANGE format to reference file). Added secretary routing note to item 6 (not applicable — promptimize is user-invoked, not agent-routed).

---

## Stage 1: Plan Review - Iteration 2 - 2026-02-24T01:18:00Z

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] Skill() tool invocation from command context has no verified precedent
- [blocker] No intermediate calibration testing — late-stage rework risk for scoring rubric
- [warning] Path pattern matching ambiguity — bare patterns won't match absolute paths
- [warning] Accept-some merge algorithm underspecified — how to map CHANGE blocks back to original
- [warning] SKILL.md line budget at risk — 15+ behaviors in <450 lines
- [warning] internet-researcher may not execute all 6 provided search queries
- [warning] validate.sh smoke test provides false confidence — only checks structural formatting

**Changes Made:**
Added Skill() precedent citation (secretary.md command lines 159, 491, 499). Added calibration check after item 3: run on 2-3 diverse prompts, revise rubric if spread < 20 points before proceeding to Phase 3. Clarified path matching is suffix-based (contains pattern, not exact glob). Added Accept-some merge strategy: original file content preserved from step 2, unselected dimensions replaced with original regions. Lowered SKILL.md target to 400 lines, proactively plan CHANGE format extraction to reference file. Added internet-researcher query risk to risks table. Enhanced intermediate smoke test to two parts: validate.sh + actual invocation on real prompt.

---

## Stage 1: Plan Review - Iteration 3 - 2026-02-24T01:22:00Z

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Approved (approved: true, 3 warnings — all self-acknowledged as "no action required")

**Issues:**
- [warning] [assumption] "promptimize" naming vs gerund convention — reviewer says "No action required", has ample precedent (game-design, crypto-analysis, root-cause-analysis)
- [warning] [feasibility] internet-researcher 6-query conflict — already mitigated in risks table, reviewer says "not a blocker"
- [warning] [dependency] Items 1-2 create skills/promptimize/references/ directory before SKILL.md — reviewer says "No action needed, internally consistent"
- [suggestion] Specify candidate prompts for calibration check (e.g., brainstorming, detecting-kanban, minimal agent)
- [suggestion] Add worked example of Accept-some merge to SKILL.md during implementation
- [suggestion] Add brief invocation scenarios for command testing

**Changes Made:**
Added "mandatory queries — execute all 6 before synthesizing" framing to Task prompt in item 5. Remaining warnings are acknowledged observations with no actionable changes.

---

## Stage 2: Chain Review - Iteration 1 - 2026-02-24T01:26:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision (approved: true, but 2 warnings under strict threshold)

**Issues:**
- [warning] Calibration gate not formalized — smoke test pass criteria undefined, calibration gate not in dependency graph
- [warning] Accept-some merge test not concrete — no defined test inputs or expected outputs in item 7
- [suggestion] WebSearch fallback testability — no guidance on simulating unavailable WebSearch

**Changes Made:**
Added explicit smoke test pass criteria ("invokes without error, produces 9-dimension report") and calibration pass criteria ("spread >= 20 points, >= 2 dimensions differ"). Added "Item 4 depends on item 3 passing this calibration gate." Made Accept-some merge test concrete: choose prompt with 2+ failing dims, accept one, reject one, verify no orphaned markers + accepted changes present + rejected original preserved.

---

## Stage 2: Chain Review - Iteration 2 - 2026-02-24T01:30:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision (approved: true, but 2 warnings under strict threshold)

**Issues:**
- [warning] Item 3 smoke test "real invocation" not concrete — what does passing look like?
- [warning] Calibration gate has no rework path — which artifact to revise if spread < 20?

**Changes Made:**
Specified smoke test pass criteria: "all 9 dimensions produce pass/partial/fail without error, report displays overall score, Strengths/Issues Found populated." Added rework path: "rework behavioral anchors in scoring-rubric.md — adjust pass/partial/fail thresholds to increase differentiation — then re-test."

---

## Stage 2: Chain Review - Iteration 3 - 2026-02-24T01:34:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Needs Revision (approved: true, but 1 warning under strict threshold)

**Issues:**
- [warning] Item 6 documentation doesn't specify which tables/sections in each file
- [suggestion] Calibration rework path has only one corrective action — add second-level fallback

**Changes Made:**
Added specific section headers for each file in item 6 ("Component Counts" table, "Skills" table, "Commands" table, ## sections). Added second-level calibration fallback: collapse two lowest-differentiating dimensions per Risks table.

---

## Task Review Iteration 1 - 2026-02-24T01:42:00Z

**Decision:** Needs Revision

**Issues:**
- [warning] Task 1.2: Done when criterion "Key rules from source files appear" is subjective — doesn't specify which rules → Tightened to list specific items: progressive disclosure from anthropic-best-practices.md, 2+ persuasion principles, token budget + macro-structures from component-authoring.md
- [warning] Task 2.2: "Applicability matrix included or referenced" creates ambiguity — embed or just reference? → Clarified: include compact inline auto-pass rules, NOT full 9x3 rubric (lives in scoring-rubric.md)
- [warning] Task 3.2: In Parallel Group C but depends only on Group A — could start after Phase 1, not Phase 2 → Added note clarifying 3.2 can start concurrent with Phase 2, grouped with 3.1 for simplicity only

**Changes Made:**
Tightened Task 1.2 Done When with specific distillation check items. Removed ambiguity in Task 2.2 by specifying compact inline reference (not full matrix). Added scheduling note to Task 3.2 and parallel groups section clarifying it depends only on Group A.

---

## Task Review Iteration 2 - 2026-02-24T01:48:00Z

**Decision:** Needs Revision

**Issues:**
- [blocker] Task 2.2: Inline reference content unspecified → Added compact auto-pass table with exactly 4 entries (3 Commands, 1 Agents), explicitly NOT full 9x3 rubric
- [blocker] Task 2.3: Unclear whether CHANGE blocks appear for all dimensions or only partial/fail → Added explicit: "Only wrap partial/fail dimensions; pass dimensions have no markers"
- [blocker] Task 2.4: Merge algorithm for Accept-some undocumented → Added step-by-step: start with improved → replace unselected blocks with original → strip markers
- [blocker] Task 2.5: What exactly moves to reference files unspecified → Specified: extract CHANGE format section through malformed fallback; add Read instruction in SKILL.md
- [warning] Task 2.6: Test prompts subjective ("diverse") → Specified 3 concrete prompts: brainstorming/SKILL.md, plan-reviewer.md, smallest agent/command
- [warning] Task 3.1: Two-location Glob role confusing → Clarified: Glob is for file discovery/selection, NOT reference loading
- [warning] Task 3.2: Prompt framing and warning formats unspecified → Added "Execute EACH of the following 6 searches" framing and concrete warning text for both fallbacks
- [warning] Task 4.1: No prerequisite verification → Added: verify command files exist with valid frontmatter before editing
- [warning] Task 5.2: Redundant with Task 2.6 → Distinguished: 5.2 tests full command→skill chain and includes Accept-some merge test (unique to 5.2)
- [suggestion] Task 3.2 should move to Phase 2.5 → Retained in Phase 3 with clarifying note (already addressed in iter 1)

**Changes Made:**
Addressed all 4 blockers: specified auto-pass table content, CHANGE marker scope, Accept-some merge algorithm, and extraction targets. Addressed 5 warnings: concrete test prompts, Glob role clarification, prompt framing with warning text, prerequisite verification, and Task 5.2 distinction.

---
