# Review History: 020-crypto-domain-skills

## Stage 1: Spec-Reviewer Review - Iteration 1 - 2026-02-08T05:40:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [feasibility] NFR-3 vs C2.1-C2.5: Brainstorming SKILL.md at 484/500 lines — adding second domain's hardcoded content exceeds budget. Spec doesn't address arithmetic conflict.
  Suggestion: Refactor to generic domain-dispatch pattern, raise limit, or extract PRD template.
- [blocker] [clarity] C2.2 Step 10 dispatch mechanism unspecified — currently hardcoded to game-design. Must specify conditional vs generic vs lookup table approach.
  Suggestion: Make Step 10 domain-generic with mapping from Step 9 selection.
- [warning] [assumptions] No loop-back behavior specified for crypto domain — current check only handles ## Game Design Analysis.
  Suggestion: Add loop-back for ## Crypto Analysis or make it generic.
- [warning] [testability] FR-9 crypto research prompts lack specificity — need actual prompt lines like game-design has.
  Suggestion: Specify 3 concrete prompt lines for internet-researcher dispatch.
- [warning] [traceability] C3 reviewer mechanism ambiguous — hardcoded second table vs dynamic parse.
  Suggestion: Pick one mechanism and document it.
- [warning] [testability] FR acceptance criteria need Given/When/Then format for measurable verification.
  Suggestion: Add concrete acceptance tests per FR.
- [warning] [assumptions] CCAF and MarketVector references undefined.
  Suggestion: Add citations or clarify as reference examples.
- [suggestion] [clarity] Add disclaimer line to Crypto Analysis header for financial advice boundary.
- [suggestion] [clarity] Add BS-8 clarifying all reference files loaded unconditionally (no sub-domain selection).

**Changes Made:**
Addressed all blockers and warnings: refactored C2 to generic domain-dispatch pattern (solved line budget), specified Step 10 dispatch mechanism, made loop-back generic, added 5 concrete crypto research prompt lines, clarified C3 as static table keyed by domain, added Given/When/Then for C2.3, added CCAF/MarketVector URLs, added BS-8 (unconditional loading), added BS-9 (disclaimer).

---

## Stage 1: Spec-Reviewer Review - Iteration 2 - 2026-02-08T05:50:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] "Base directory" term undefined in C2.2
- [warning] PRD-to-spec scope deviation undocumented (generic dispatch was PRD's Out of Scope)
- [warning] Line budget math uses approximate values
- [warning] Acceptance criteria inconsistent (C2.3 uses Given/When/Then, others don't)
- [warning] Two-phase write buffer not explicitly cleared in loop-back
- [suggestion] Remove "target" line counts from C4 (keep only max)
- [suggestion] Add sentence to C2.5 about source of truth shifting to domain SKILL.md

**Changes Made:**
None required — all warnings are non-blocking and approved for design phase.

---

## Stage 2: Phase Review - 2026-02-08T06:00:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] C2.1 registry format not explicitly stated as static inline mapping
- [warning] Game-design SKILL.md Stage 2 Research Context migration content not specified
- [warning] Line budget analysis not provided as explicit net delta calculation
- [warning] C2.5 two-line generic placeholder text not shown
- [suggestion] C4.7 review-criteria.md should state "follows same structure as game-design/references/review-criteria.md"
- [suggestion] BS-9 disclaimer relationship to "Does NOT" list could be clearer

**Changes Made:**
Addressed all warnings from both reviewers: clarified registry as static inline mapping (C2.1), defined "Base directory" (C2.2), explicit loop-back buffer clearing (C2.2), exact line budget breakdown (C2.2), game-design migration lines specified (C2.3), Given/When/Then for C2.1/C2.2/C2.4/C2.5, C2.5 source-of-truth note, removed target line counts from C4, C4.7 pattern reference, BS-9 relationship to BS-5, PRD-to-spec deviation acknowledgment.

---

## Stage 1: Spec-Reviewer Review - Iteration 3 - 2026-02-08T06:10:00Z

**Reviewer:** spec-reviewer (skeptic)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] [assumptions] game-design SKILL.md modification not in traceability matrix (In Scope mentions it, but no FR row)
- [warning] [clarity] 1-line count inconsistency (484 in overview vs 485 in line budget) — fixed to 485
- [suggestion] [clarity] C4.7 dual-source pattern well-handled, no change needed
- [suggestion] [traceability] PRD-to-spec deviation properly documented, no change needed

All 7 items from iteration 2 verified as fixed.

**Changes Made:**
Fixed 484→485 inconsistency in overview. Remaining warnings are non-blocking observations.

---

## Stage 2: Phase Review (re-run) - 2026-02-08T06:10:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] game-design SKILL.md line count impact (104→~110) not in line budget analysis
- [warning] Base directory is implicit runtime behavior (designer can infer from current path resolution)
- [warning] Step 9 "~2 lines removed" may be overstated (but ~34 lines margin covers it)
- [suggestion] Stage 2 Research Context section placement within SKILL.md not specified (designer infers from game-design pattern)
- [suggestion] brainstorm-reviewer has pre-existing "backward compatible" phrase (outside spec scope)

**Changes Made:**
None required — all warnings are non-blocking. Phase-reviewer confirmed spec is ready for design.

---

## Design Review - Iteration 1 - 2026-02-08T06:45:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Needs Revision

**Issues:**
- [blocker] [consistency] C2.1 line budget: actual Step 9 is 15 lines (not 13), new is ~20 (not 15). Delta is +5, not +2. Total shifts from -25 to -22 (at: C2.1 line budget table)
  Challenge: Line counts don't match actual file on disk
- [blocker] [completeness] Loop-back detection uses generic heading check that could false-match "## Structured Analysis" (at: C2.2 loop-back)
  Challenge: Need exact detection mechanism that avoids false positives
- [warning] [consistency] Game-design SKILL.md is 103 lines (not 104), 120-line limit claim ungrounded (at: C5)
  Challenge: Is there a documented line limit for game-design SKILL.md?
- [warning] [completeness] Stage 2 Research Context expected format unspecified (at: TD-2, I-3)
  Challenge: What constitutes a valid section body?
- [warning] [completeness] BS-9 disclaimer not shown in C1 Output section structure (at: C1 SKILL.md structure)
  Challenge: Output template should include the disclaimer
- [warning] [assumptions] BigQuery prompt line implies researcher can query BigQuery directly, but it uses WebSearch (at: I-3, C1 Stage 2 Research Context)
  Challenge: Rephrase to match internet-researcher's actual capabilities
- [warning] [consistency] C2.5 generic placeholder is a meta-instruction, not literal template — distinction needs clarification (at: C2.5, Stage 3)
  Challenge: How does LLM know to substitute {Domain}?
- [warning] [feasibility] TD-4 merge mechanism undefined — how does LLM combine Step 10 + Stage 2 data? (at: TD-4, I-6)
  Challenge: Specify the concrete merge approach

**Changes Made:**
1. Fixed C2.1: actual 15 lines → new ~20 lines, delta +5. Updated total from -25 to -22 (485 → 464)
2. Specified loop-back detection: uses stored domain display name for exact heading match, not wildcard. Added Analysis Heading column to domain mapping table
3. Fixed game-design line count: 103 → ~109 (not 104 → ~110). Cited Feature 019 convention
4. Added Stage 2 Research Context expected format: preamble line + bulleted markdown list
5. Expanded C1 Output section to explicitly show disclaimer and 4 subsection names
6. Rephrased BigQuery prompt: "Research publicly available on-chain data" instead of "Query BigQuery". Added note about WebSearch limitation
7. Clarified C2.5 is a meta-instruction, not literal template. Domain skill's Output section is source of truth
8. Expanded TD-4 merge mechanism: LLM rewrites subsections 3-4 by combining framework + research data, same mechanism as game-design
9. Fixed File Modification Summary: brainstorming -21 (not -25), game-design 103→109, brainstorm-reviewer 134→141
10. Updated R-1 risk mitigation: -22 lines → 464, 36 lines headroom

---

## Design Review - Iteration 2 - 2026-02-08T06:55:00Z

**Reviewer:** design-reviewer (skeptic)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] [consistency] File Modification Summary table shows -21 for brainstorming, body text says -22. Arithmetic is -22.
  Challenge: Reconcile table with body text.
- [warning] [consistency] Design baseline 485 lines, actual file 484. Off-by-1 propagates to totals.
  Challenge: Verify exact baseline.
- [warning] [completeness] C3 criteria table selection mechanism not explicitly specified as conditional block.
  Challenge: How does reviewer select which table?
- [note] [completeness] Mapping table rows not shown concretely (Label → Dir Name → Analysis Heading).
- [note] [completeness] C1 Output subsection H3 headings not listed; must match C3 table exactly.

All iteration 1 fixes verified as adequate. No blockers found.

**Changes Made:**
1. Fixed File Modification Summary: -21 → -22 for brainstorming/SKILL.md
2. Added explicit C3 table selection mechanism description (conditional block keyed by Domain: value)
3. Added concrete mapping table rows as markdown table
4. Added C1/C3 alignment requirement note (H3 headings must match criteria table)

---

## Handoff Review - 2026-02-08T07:00:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] 485 vs 484 off-by-one baseline discrepancy propagated from spec. Immaterial with 36 lines headroom.
- [warning] C3 conditional syntax for second criteria table not shown explicitly. I-5 pseudocode provides the pattern.
- [warning] Data flow step 4 oversimplifies merge rule. TD-4 and I-6 are authoritative.
- [suggestion] Spec's Stage 2 Research Context prompt lines (C2.3) use "Query BigQuery" phrasing; design's I-3 correctly rephrases for WebSearch. Planner should use design's I-3 as source of truth.
- [suggestion] Game-design SKILL.md baseline 103 vs 104 (trailing blank line). +6 delta is the actionable number.

---

## Stage 1: Plan Review - Iteration 1 - 2026-02-08T07:10:00Z

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] Spec/design discrepancy on Stage 2 prompt wording needs source-of-truth callout (at: Phase 1, Step 1.1)
- [warning] Brainstorm-reviewer table selection mechanism integration with existing step 6 text unspecified (at: Phase 4, Step 4.1)
- [warning] Phase 3 rollback strategy missing for partial refactor failure (at: Phase 3 preamble)
- [warning] No inter-phase validate.sh checkpoints before high-risk Phase 3 (at: All phases)
- [note] SKILL.md description should follow "Use when" pattern for validate.sh (at: Phase 1, Step 1.1)
- [note] Crypto-analysis SKILL.md line budget tight at ~110-115 lines given extra Stage 2 section (at: Phase 1, Step 1.1)
- [note] Phase 4 has implicit dependency on Phase 3 for end-to-end crypto validation (at: Phase 4, Dependencies)

**Changes Made:**
1. Added source-of-truth hierarchy note: design I-3 supersedes spec C1 for Stage 2 prompt wording
2. Added Phase 3 rollback strategy: atomic — all 5 modifications ship together or none do
3. Added "Use when" pattern note in Step 1.1 description field
4. Added Phase 1 checkpoint: run validate.sh before Phase 3
5. Added SKILL.md line budget note for crypto-analysis (~110-115 lines, tight but feasible)
6. Added validate.sh run after Phase 2 game-design modification
7. Expanded Phase 4 dependencies to include Phase 3 for end-to-end validation
8. Expanded Step 4.1 to clarify how table selection mechanism integrates with existing step 6 text

---

## Stage 2: Chain Review - 2026-02-08T07:15:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] Game-design SKILL.md line count: plan says 103, actual may be 104 (trailing blank line). Immaterial — +6 delta is the actionable number.
- [warning] Spec/design line budget discrepancy (spec: -20/~466, design: -22/464) not called out in source-of-truth hierarchy.
- [warning] Spec/design loop-back detection discrepancy (spec: "any heading", design: exact match) not called out.
- [suggestion] review-criteria.md will be ~55 lines (matching game-design pattern), well under 160.
- [suggestion] Phase 4 dependency on Phase 3 is for validation, not implementation — could be sequenced earlier.

**Changes Made:**
1. Expanded source-of-truth hierarchy to cover 3 discrepancies: Stage 2 prompt wording, loop-back detection mechanism, and line budget numbers

---

## Stage 1: Plan Review - Iteration 2 - 2026-02-08T07:25:00Z

**Reviewer:** plan-reviewer (skeptic)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] PRD says 484 lines vs plan's 485 — plan uses correct (verified) number
- [warning] Possible off-by-one in +1 crypto option vs C2.1 delta — caught by wc -l verification gate
- [warning] No explicit H3 heading finalization checkpoint between Step 1.1 and Phase 4
- [note] validate.sh enforces 500-line limit, not 120 — manual wc -l needed for NFR-1
- [note] Build-then-verify approach appropriate for markdown skill deliverables

---

## Stage 2: Chain Review - Iteration 2 - 2026-02-08T07:25:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] Step 3.2 loop-back: "stored-analysis-heading" data source could be ambiguous — clarified with example
- [warning] Step 4.1 severity rule location in reviewer file not specified
- [suggestion] Add Phase 3 checkpoint (validate.sh after Step 3.6)
- [suggestion] Add wc -l to Phase 2 verify for consistency

**Changes Made:**
1. Step 3.2 loop-back: changed to "Analysis Heading from Step 9 mapping table" with example
2. Step 3.6: added validate.sh run after Phase 3
3. Step 4.1 verify: clarified existing severity rule applies to new table

---

## Stage 1: Plan Review - Iteration 3 (addressing remaining non-blocking) - 2026-02-08T07:30:00Z

**Changes Made (addressing iteration 2 non-blocking items):**
1. Fixed line budget double-count: C2.1 +5 delta already includes crypto option. Corrected 464→463, 36→37 headroom
2. Added PRD 484 vs actual 485 note to source-of-truth hierarchy
3. Added H3 heading finalization note to Step 1.1 Verify — headings finalized here, Phase 4 must use these exact strings
4. Added `wc -l` to Phase 2 Step 2.1 Verify for consistency with Phase 3 pattern
5. Clarified Phase 1 checkpoint: validate.sh checks 500-line limit, not 120 — use `wc -l` for NFR-1
6. Added `wc -l` to Step 1.1 Verify

---

## Stage 1: Plan Review - Iteration 3 - 2026-02-08T07:35:00Z

**Reviewer:** plan-reviewer (skeptic)
**Decision:** False-positive rejection — reviewer confused plan review with implementation review. Flagged that crypto-analysis SKILL.md "doesn't exist" and brainstorming "hasn't been modified" as blockers. These are the planned deliverables, not prerequisites. No legitimate plan-quality issues found. All iteration 2 fixes verified.

---

## Stage 2: Chain Review - Iteration 3 - 2026-02-08T07:35:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues:** None. "Plan is ready for task breakdown."

---

## Task Review Iteration 1 - 2026-02-08T07:45:00Z

**Decision:** Approved

**Issues:**
- [warning] Task 3.1: Line range boundary ambiguity — unclear whether Step 9 heading at line 108 is replaced or retained → Clarified: replace heading + body as single block
- [warning] Task 3.2: Same heading boundary ambiguity for Step 10 at line 124 → Clarified: replace heading + body as single block
- [warning] Task 1.1: Output field templates require cross-referencing spec C1 → Added inline reference to spec.md lines 39-62 and field count (4 fields × 4 subsections = 16 total)
- [warning] Task 1.1: Domain review criteria not listed inline → Added all 4 criteria inline with exact match requirement
- [warning] Task 3.5: PRD template replacement boundary ambiguity at line 448 → Clarified: includes blank separator, preserve separator before Review History
- [suggestion] Tasks 1.2a-g: H2 section count per file not specified
- [suggestion] Task 2.1: Insertion point could be more specific
- [suggestion] Task 4.1: Insertion line for crypto table not specified
- [suggestion] Task 1.1: Stage 2 prompt lines not listed inline → Added all 5 lines inline
- [suggestion] Dependency diagram ASCII art has ambiguous connections

**Changes Made:**
1. Task 1.1: Added inline field template reference (spec.md lines 39-62, 16 fields total)
2. Task 1.1: Added 4 domain review criteria inline with exact match requirement
3. Task 1.1: Added 5 Stage 2 Research Context prompt lines inline
4. Task 3.1: Clarified line range includes heading ("Step 9 heading + body, 15 lines total")
5. Task 3.2: Clarified line range includes heading ("Step 10 heading + body, 10 lines total")
6. Task 3.5: Clarified replacement boundary and blank line preservation

---

## Stage 2: Chain Review - 2026-02-08T07:50:00Z

**Reviewer:** phase-reviewer (gatekeeper)
**Decision:** Approved

**Issues (non-blocking):**
- [warning] Task 3.1 line range boundary ambiguity for blank separator at line 123 — mitigated by content-based Done criteria
- [warning] Task 2.1 game-design line count 103 vs 104 (trailing newline) — immaterial with <120 constraint
- [warning] Task 1.1 cross-reference chain (spec C1 → design I-3) adds cognitive load — resolved by documented source-of-truth hierarchy
- [suggestion] Dependency graph ASCII art has minor visual ambiguity — textual description at lines 179-188 is unambiguous

---
